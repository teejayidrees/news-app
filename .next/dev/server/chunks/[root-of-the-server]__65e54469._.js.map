{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Desktop/news-website/lib/cache.js"],"sourcesContent":["const cache = new Map()\n\n/**\n * Get cached data if it exists and is still fresh\n * @param {string} key - Cache key\n * @returns {any|null} - Cached data or null if not found/expired\n */\nexport function getCached(key) {\n  const item = cache.get(key)\n  if (!item) return null\n\n  // Check if cache has expired\n  if (Date.now() - item.timestamp > item.duration) {\n    cache.delete(key)\n    return null\n  }\n\n  return item.data\n}\n\n/**\n * Set data in cache with expiration\n * @param {string} key - Cache key\n * @param {any} data - Data to cache\n * @param {number} duration - Cache duration in milliseconds (default: 60 seconds)\n */\nexport function setCached(key, data, duration = 60000) {\n  cache.set(key, {\n    data,\n    timestamp: Date.now(),\n    duration,\n  })\n}\n\n/**\n * Clear all cache entries\n */\nexport function clearCache() {\n  cache.clear()\n}\n\n/**\n * Get cache statistics\n */\nexport function getCacheStats() {\n  return {\n    size: cache.size,\n    keys: Array.from(cache.keys()),\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA,MAAM,QAAQ,IAAI;AAOX,SAAS,UAAU,GAAG;IAC3B,MAAM,OAAO,MAAM,GAAG,CAAC;IACvB,IAAI,CAAC,MAAM,OAAO;IAElB,6BAA6B;IAC7B,IAAI,KAAK,GAAG,KAAK,KAAK,SAAS,GAAG,KAAK,QAAQ,EAAE;QAC/C,MAAM,MAAM,CAAC;QACb,OAAO;IACT;IAEA,OAAO,KAAK,IAAI;AAClB;AAQO,SAAS,UAAU,GAAG,EAAE,IAAI,EAAE,WAAW,KAAK;IACnD,MAAM,GAAG,CAAC,KAAK;QACb;QACA,WAAW,KAAK,GAAG;QACnB;IACF;AACF;AAKO,SAAS;IACd,MAAM,KAAK;AACb;AAKO,SAAS;IACd,OAAO;QACL,MAAM,MAAM,IAAI;QAChB,MAAM,MAAM,IAAI,CAAC,MAAM,IAAI;IAC7B;AACF"}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Desktop/news-website/lib/fetchNews.js"],"sourcesContent":["// Import two helper functions that manage in-memory caching.\n// getCached(key)  → returns cached data if still valid\n// setCached(key, data, ttl) → stores data in cache with an expiry time\nimport { getCached, setCached } from \"./cache\";\n\n// Base URL of the NewsAPI service.\n// NEWS_API_BASE can come from environment variables, otherwise defaults to NewsAPI's v2 endpoint.\nconst NEWS_API_BASE = process.env.NEWS_API_BASE || \"https://newsapi.org/v2\";\n\n// API Key for authenticating NewsAPI requests.\n// Must be stored in environment variables for security.\nconst NEWS_API_KEY = process.env.NEWS_API_KEY;\n\n/**\n * Core function to fetch news from NewsAPI with caching support.\n * This ensures:\n *   - Reduced API usage → prevents hitting rate limits\n *   - Faster responses → because cached data loads instantly\n *\n * @param {string} endpoint - NewsAPI endpoint like \"top-headlines\" or \"everything\"\n * @param {Object} params - Query parameters to attach to the request\n * @returns {Promise<Object>} - Parsed JSON response from NewsAPI\n */\nexport async function fetchNews(endpoint, params = {}) {\n  // Build a unique cache key using endpoint + parameters\n  // Example key: \"top-headlines-{\"country\":\"ng\"}\"\n  const cacheKey = `${endpoint}-${JSON.stringify(params)}`;\n\n  // ---------------------------------------------------\n  // 1️⃣ CHECK CACHE FIRST\n  // ---------------------------------------------------\n  const cached = getCached(cacheKey);\n  if (cached) {\n    console.log(\"[Cache Hit]\", cacheKey);\n    return cached; // instantly return cached data\n  }\n\n  // ---------------------------------------------------\n  // 2️⃣ BUILD FULL API URL WITH QUERY PARAMETERS\n  // ---------------------------------------------------\n  const queryParams = new URLSearchParams({\n    ...params,\n    apiKey: NEWS_API_KEY, // attach API key to every request\n  });\n\n  const url = `${NEWS_API_BASE}/${endpoint}?${queryParams}`;\n\n  try {\n    console.log(\"[API Call]\", endpoint, params, url);\n\n    // Make the actual request to NewsAPI\n    // `next: { revalidate: 60 }` → Next.js ISR will cache the response for 60 seconds\n    const response = await fetch(url, {\n      next: { revalidate: 60 },\n    });\n\n    // ---------------------------------------------------\n    // 3️⃣ HANDLE API ERRORS (including rate limit 429)\n    // ---------------------------------------------------\n    if (!response.ok) {\n      // NewsAPI returns 429 when too many requests are sent\n      if (response.status === 429) {\n        console.warn(\"[Rate Limited] Attempting to use stale cache\");\n\n        // If cached data exists, return it instead of failing\n        const staleCache = getCached(cacheKey);\n        if (staleCache) return staleCache;\n      }\n\n      // Throw generic error for other API failures\n      throw new Error(\n        `NewsAPI error: ${response.status} ${response.statusText}`\n      );\n    }\n\n    // ---------------------------------------------------\n    // 4️⃣ PARSE DATA\n    // ---------------------------------------------------\n    const data = await response.json();\n\n    // ---------------------------------------------------\n    // 5️⃣ SAVE NEW DATA IN CACHE (TTL = 60 seconds)\n    // ---------------------------------------------------\n    setCached(cacheKey, data, 60000);\n\n    return data;\n  } catch (error) {\n    console.error(\"[Fetch Error]\", error);\n\n    // If API call failed (network issue, API down...), use stale cache\n    const staleCache = getCached(cacheKey);\n    if (staleCache) {\n      console.log(\"[Using Stale Cache]\", cacheKey);\n      return staleCache;\n    }\n\n    // No cache available → rethrow error\n    throw error;\n  }\n}\n\n/**\n * Fetch top headlines for a specific country and optional category.\n *\n * @param {string} country - ISO country code (default: \"ng\" for Nigeria)\n * @param {string|null} category - News category like \"sports\", \"tech\", etc.\n */\n// export async function fetchTopHeadlines(country = \"ng\", category = null) {\n//   const params = { country };\n//   if (category) params.category = category; // optional\n\n//   return fetchNews(\"top-headlines\", params);\n// }\nexport async function fetchTopHeadlines(country = \"ng\", category = null) {\n  // If no category is supplied → fetch a LOT of Nigerian news\n  if (!category) {\n    return fetchNews(\"everything\", {\n      q: \"Nigeria\", // broad Nigeria search\n      language: \"en\",\n      sortBy: \"publishedAt\",\n      pageSize: 100, // maximum allowed\n    });\n  }\n\n  // If a category IS supplied → use the proper endpoint\n  return fetchNews(\"top-headlines\", {\n    country,\n    category,\n    pageSize: 100,\n  });\n}\n\n/**\n * Fetch news based on category.\n * Uses two logic paths:\n *   - If category is \"crypto\", use /everything because top-headlines doesn't support it well.\n *   - Otherwise use /top-headlines.\n *\n * @param {string} category - e.g., \"sports\", \"business\", \"crypto\"\n */\nexport async function fetchByCategory(category) {\n  // Dedicated handling for crypto queries\n  if (category === \"crypto\") {\n    return fetchNews(\"everything\", {\n      q: \"crypto\",\n      sortBy: \"publishedAt\",\n      language: \"en\",\n    });\n  }\n\n  // Standard category-based headlines\n  return fetchNews(\"top-headlines\", {\n    category,\n    language: \"en\",\n  });\n}\n\n/**\n * Search for articles by text query.\n *\n * @param {string} query - Search keywords\n */\nexport async function searchNews(query) {\n  return fetchNews(\"everything\", {\n    q: query,\n    sortBy: \"publishedAt\",\n    language: \"en\",\n  });\n}\n\n/**\n * Find a specific article by its title.\n * This is mainly used when you click a news card and want the full article content.\n *\n * @param {string} title - Exact article title\n */\nexport async function getArticleByTitle(title) {\n  // Search the exact phrase by adding quotes\n  const data = await searchNews(`${title}`);\n\n  if (!data.articles || data.articles.length === 0) {\n    return null;\n  }\n\n  // Try to find article with exact title match\n  const article = data.articles.find((a) => a.title === title);\n\n  // If no exact match exists, return first result as fallback\n  return article || data.articles[0];\n}\n\n/**\n * Sort articles from newest → oldest.\n *\n * @param {Array} articles - List of article objects\n */\nexport function sortByNewest(articles) {\n  if (!articles || !Array.isArray(articles)) return [];\n\n  return articles.sort((a, b) => {\n    const dateA = new Date(a.publishedAt);\n    const dateB = new Date(b.publishedAt);\n    return dateB - dateA; // newest first\n  });\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 238, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/hp/Desktop/news-website/app/api/search/route.ts"],"sourcesContent":["import { searchNews } from \"@/lib/fetchNews\"\nimport { type NextRequest, NextResponse } from \"next/server\"\n\nexport async function GET(request: NextRequest) {\n  const searchParams = request.nextUrl.searchParams\n  const query = searchParams.get(\"q\")\n\n  if (!query) {\n    return NextResponse.json({ error: \"Search query is required\" }, { status: 400 })\n  }\n\n  try {\n    const data = await searchNews(query)\n    return NextResponse.json(data)\n  } catch (error) {\n    console.error(\"Search API error:\", error)\n    return NextResponse.json({ error: \"Failed to search news\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;IACjD,MAAM,QAAQ,aAAa,GAAG,CAAC;IAE/B,IAAI,CAAC,OAAO;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;IAEA,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,gIAAU,EAAC;QAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}